<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ èŒèŒè¡¨æƒ…å·¥åŠ | AI Emoji Workflow</title>

    <!-- æ ¸å¿ƒåº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

    <!-- å­—ä½“ -->
    <link
        href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans SC"', 'sans-serif'],
                        cute: ['"Fredoka"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            pink: '#FFB7B2',
                            blue: '#A2E1DB',
                            yellow: '#FFDAC1',
                            purple: '#E2F0CB',
                            dark: '#4A4A4A'
                        }
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #FFF5F5;
            background-image: radial-gradient(#FFE4E1 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 4px solid #FFF;
            box-shadow: 0 10px 25px -5px rgba(255, 183, 178, 0.3);
        }

        .btn-cute {
            transition: all 0.2s;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
        }

        .btn-cute:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0);
        }

        .tab-active {
            background-color: #fff;
            color: #FFB7B2;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .bg-checkerboard {
            background-image: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body class="text-brand-dark min-h-screen pb-20" x-data="app()" x-init="initApp()">

    <!-- é¡¶éƒ¨é€šçŸ¥ (Toast) -->
    <div class="fixed top-6 left-1/2 -translate-x-1/2 z-[60] transition-all duration-300 pointer-events-none"
        x-show="toast.show" x-transition:enter="transform ease-out duration-300 transition-translate-y"
        x-transition:enter-start="translate-y-[-100%] opacity-0" x-transition:enter-end="translate-y-0 opacity-100"
        x-transition:leave="transform ease-in duration-200" x-transition:leave-start="translate-y-0 opacity-100"
        x-transition:leave-end="translate-y-[-100%] opacity-0" x-cloak>
        <div
            class="bg-brand-dark text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-2 font-bold border-2 border-white">
            <i data-lucide="sparkles" class="w-5 h-5 text-brand-yellow"></i>
            <span x-text="toast.message"></span>
        </div>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b-4 border-brand-pink mb-8 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3 select-none cursor-pointer" @click="mode='prompt'">
                <div
                    class="w-12 h-12 bg-gradient-to-br from-brand-pink to-brand-yellow rounded-2xl flex items-center justify-center text-white shadow-lg transform -rotate-3 hover:rotate-0 transition-transform duration-300">
                    <i data-lucide="smile-plus" class="w-7 h-7"></i>
                </div>
                <div>
                    <h1 class="font-cute text-2xl font-bold text-gray-800 tracking-wide">èŒèŒè¡¨æƒ…å·¥åŠ</h1>
                    <p class="text-xs text-gray-400 font-sans font-medium">Nano Banana Pro ä¸“ç”¨å·¥å…·</p>
                </div>
            </div>

            <!-- å¯¼èˆª Tab -->
            <div class="flex bg-gray-100 p-1.5 rounded-full gap-1 overflow-x-auto">
                <button @click="mode = 'prompt'"
                    :class="mode === 'prompt' ? 'tab-active' : 'text-gray-400 hover:text-gray-600'"
                    class="px-4 md:px-5 py-2 rounded-full font-bold transition-all text-sm flex items-center gap-2 whitespace-nowrap">
                    <i data-lucide="wand-2" class="w-4 h-4"></i> <span class="hidden md:inline">1.</span> è·å–å’’è¯­
                </button>
                <button @click="mode = 'cutter'"
                    :class="mode === 'cutter' ? 'tab-active' : 'text-gray-400 hover:text-gray-600'"
                    class="px-4 md:px-5 py-2 rounded-full font-bold transition-all text-sm flex items-center gap-2 whitespace-nowrap">
                    <i data-lucide="scissors" class="w-4 h-4"></i> <span class="hidden md:inline">2.</span> æ™ºèƒ½åˆ‡å›¾
                </button>
                <button @click="mode = 'animator'"
                    :class="mode === 'animator' ? 'tab-active' : 'text-gray-400 hover:text-gray-600'"
                    class="px-4 md:px-5 py-2 rounded-full font-bold transition-all text-sm flex items-center gap-2 whitespace-nowrap">
                    <i data-lucide="film" class="w-4 h-4"></i> <span class="hidden md:inline">3.</span> åˆ¶ä½œåŠ¨å›¾
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4">

        <!-- ==================== æ¨¡å¼ 1: å’’è¯­ç”Ÿæˆ (Prompt Station) ==================== -->
        <div x-show="mode === 'prompt'" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform -translate-x-4"
            x-transition:enter-end="opacity-100 transform translate-x-0">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-cute font-bold text-brand-dark mb-2">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ä½ çš„ç›®æ ‡</h2>
                <p class="text-gray-500">è¿™é‡Œçš„å’’è¯­ä¸“ä¸º <b>Nano Banana Pro</b> ä¼˜åŒ–ï¼Œè¯·æ ¹æ®éœ€æ±‚é€‰æ‹©</p>
            </div>

            <!-- å’’è¯­ç±»å‹åˆ‡æ¢ -->
            <div class="flex justify-center mb-8">
                <div class="bg-white p-1.5 rounded-2xl shadow-sm border border-gray-100 inline-flex">
                    <button @click="promptType = 'grid'"
                        :class="promptType === 'grid' ? 'bg-brand-blue text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'"
                        class="px-6 py-2 rounded-xl font-bold transition-all text-sm flex items-center gap-2">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> åˆ¶ä½œé™æ€ç»„å›¾ (åˆ‡å›¾ç”¨)
                    </button>
                    <button @click="promptType = 'single'"
                        :class="promptType === 'single' ? 'bg-brand-pink text-white shadow-md' : 'text-gray-500 hover:bg-gray-50'"
                        class="px-6 py-2 rounded-xl font-bold transition-all text-sm flex items-center gap-2">
                        <i data-lucide="user" class="w-4 h-4"></i> åˆ¶ä½œåŠ¨å›¾ç´ æ (å•å¼ ç”¨)
                    </button>
                </div>
            </div>

            <div class="max-w-4xl mx-auto">
                <!-- é™æ€ç»„å›¾ Prompt -->
                <div x-show="promptType === 'grid'"
                    class="glass-panel rounded-3xl p-8 relative group border-brand-blue/30 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="absolute top-6 right-6">
                        <button @click="copyText(prompts.grid)"
                            class="p-3 bg-brand-blue text-white rounded-full shadow-lg hover:bg-blue-300 transition-all transform hover:scale-110"
                            title="ä¸€é”®å¤åˆ¶">
                            <i data-lucide="copy" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-3 mb-4 text-brand-blue">
                        <div class="p-2 bg-blue-50 rounded-lg">
                            <i data-lucide="layout-grid" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-gray-800">4x6 è¡¨æƒ…åŒ…ç»„å›¾å’’è¯­</h3>
                            <p class="text-xs text-gray-400">ç”Ÿæˆä¸€å¼ åŒ…å«24ä¸ªè¡¨æƒ…çš„å¤§å›¾ï¼Œé€‚åˆåˆ‡å‰²ä½¿ç”¨</p>
                        </div>
                    </div>
                    <div
                        class="bg-blue-50/50 rounded-2xl p-6 text-sm text-gray-700 font-mono leading-relaxed border-2 border-blue-100/50 select-all">
                        <p x-text="prompts.grid"></p>
                    </div>
                    <div class="mt-4 text-xs text-gray-400 flex items-center gap-1">
                        <i data-lucide="info" class="w-3 h-3"></i>
                        <span>ç”Ÿæˆåè¯·å‰å¾€ã€Œæ™ºèƒ½åˆ‡å›¾ã€æ¨¡å¼ä¸Šä¼ å›¾ç‰‡ã€‚</span>
                    </div>
                </div>

                <!-- åŠ¨å›¾ç´ æ Prompt -->
                <div x-show="promptType === 'single'"
                    class="glass-panel rounded-3xl p-8 relative group border-brand-pink/30 animate-in fade-in slide-in-from-bottom-4 duration-500"
                    x-cloak>
                    <div class="absolute top-6 right-6">
                        <button @click="copyText(prompts.single)"
                            class="p-3 bg-brand-pink text-white rounded-full shadow-lg hover:bg-pink-300 transition-all transform hover:scale-110"
                            title="ä¸€é”®å¤åˆ¶">
                            <i data-lucide="copy" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-3 mb-4 text-brand-pink">
                        <div class="p-2 bg-pink-50 rounded-lg">
                            <i data-lucide="sparkles" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-gray-800">å•å¼ åŠ¨å›¾ç´ æå’’è¯­</h3>
                            <p class="text-xs text-gray-400">ç”Ÿæˆå•å¼ é«˜è´¨é‡ã€èƒŒæ™¯å¹²å‡€çš„è§’è‰²å›¾ï¼Œé€‚åˆåˆ¶ä½œç‰¹æ•ˆåŠ¨å›¾</p>
                        </div>
                    </div>
                    <div
                        class="bg-pink-50/50 rounded-2xl p-6 text-sm text-gray-700 font-mono leading-relaxed border-2 border-pink-100/50 select-all">
                        <p x-text="prompts.single"></p>
                    </div>
                    <div class="mt-4 text-xs text-gray-400 flex items-center gap-1">
                        <i data-lucide="info" class="w-3 h-3"></i>
                        <span>ç”Ÿæˆåè¯·å‰å¾€ã€Œåˆ¶ä½œåŠ¨å›¾ã€æ¨¡å¼ä¸Šä¼ å›¾ç‰‡ã€‚</span>
                    </div>
                </div>
            </div>

            <div class="mt-12 text-center">
                <button @click="mode = promptType === 'grid' ? 'cutter' : 'animator'"
                    class="btn-cute px-10 py-4 bg-brand-dark text-white rounded-full font-bold shadow-xl shadow-gray-200 inline-flex items-center gap-2 hover:bg-gray-800 transform hover:scale-105 transition-all">
                    <span>å»ä¸‹ä¸€æ­¥</span> <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- ==================== æ¨¡å¼ 2: è¡¨æƒ…åˆ‡å›¾ (Cutter) ==================== -->
        <div x-show="mode === 'cutter'" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-x-4"
            x-transition:enter-end="opacity-100 transform translate-x-0" x-cloak>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- å·¦ä¾§ï¼šä¸Šä¼ ä¸æ“ä½œ -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="glass-panel rounded-3xl p-6">
                        <div class="text-center mb-6">
                            <h2 class="font-cute text-xl font-bold mb-2 text-gray-700">ç¬¬äºŒæ­¥ï¼šä¸Šä¼ åˆ‡å›¾</h2>
                            <p class="text-sm text-gray-500">ä¸Šä¼  4x6 å¸ƒå±€çš„å¤§å›¾ï¼Œè‡ªåŠ¨åˆ‡åˆ†ä¸º24ä¸ªè¡¨æƒ…</p>
                        </div>

                        <label class="block w-full cursor-pointer group">
                            <div
                                class="border-4 border-dashed border-brand-blue rounded-2xl h-48 flex flex-col items-center justify-center text-gray-400 bg-white group-hover:bg-blue-50 group-hover:border-blue-400 transition-all relative overflow-hidden">
                                <template x-if="!cutter.uploadedImage">
                                    <div class="text-center">
                                        <i data-lucide="upload-cloud"
                                            class="w-12 h-12 mb-2 mx-auto text-brand-blue group-hover:scale-110 transition-transform"></i>
                                        <span class="font-bold text-sm">ç‚¹å‡»ä¸Šä¼  AI ç”Ÿæˆå›¾</span>
                                    </div>
                                </template>
                                <template x-if="cutter.uploadedImage">
                                    <img :src="cutter.uploadedImage" class="w-full h-full object-cover opacity-50">
                                </template>
                                <div x-show="cutter.uploadedImage"
                                    class="absolute inset-0 flex items-center justify-center bg-black/30 text-white font-bold">
                                    <span>ç‚¹å‡»æ›´æ¢å›¾ç‰‡</span>
                                </div>
                            </div>
                            <input type="file" accept="image/*" class="hidden" @change="handleCutterUpload">
                        </label>

                        <!-- è‡ªåŠ¨å¤„ç†çŠ¶æ€ -->
                        <div x-show="cutter.isProcessing" class="mt-6 text-center py-4">
                            <div
                                class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-brand-pink border-t-transparent">
                            </div>
                            <p class="text-sm text-brand-pink font-bold mt-2">æ­£åœ¨æ™ºèƒ½åˆ‡å‰²ä¸­...</p>
                        </div>

                        <!-- ç»“æœæ“ä½œ -->
                        <div x-show="cutter.slices.length > 0 && !cutter.isProcessing"
                            class="mt-6 space-y-3 animate-wiggle-enter">
                            <div
                                class="bg-green-50 text-green-700 px-4 py-3 rounded-xl text-sm font-bold flex items-center gap-2 border border-green-100">
                                <i data-lucide="check-circle-2" class="w-5 h-5"></i>
                                æˆåŠŸåˆ‡å‰²å‡º <span x-text="cutter.slices.length"></span> ä¸ªè¡¨æƒ…ï¼
                            </div>
                            <button @click="downloadAllSlices"
                                class="btn-cute w-full py-3 rounded-xl bg-brand-blue text-white font-bold shadow-lg shadow-blue-200 flex items-center justify-center gap-2 hover:bg-blue-300">
                                <i data-lucide="package" class="w-5 h-5"></i>
                                æ‰“åŒ…ä¸‹è½½ (ZIP)
                            </button>
                        </div>
                    </div>

                    <div
                        class="bg-white rounded-2xl p-5 border-2 border-brand-yellow shadow-sm relative overflow-hidden">
                        <div class="absolute -right-4 -top-4 w-16 h-16 bg-brand-yellow rounded-full opacity-20"></div>
                        <h3 class="font-bold text-gray-700 mb-2 flex items-center gap-2">
                            <i data-lucide="lightbulb" class="w-4 h-4 text-orange-400"></i> å°è´´å£«
                        </h3>
                        <p class="text-xs text-gray-500 leading-relaxed">
                            ç‚¹å‡»å³ä¾§ä»»æ„ä¸€ä¸ªå°è¡¨æƒ…ä¸Šçš„ <i data-lucide="film"
                                class="w-3 h-3 inline align-middle bg-gray-100 rounded p-0.5"></i>
                            å›¾æ ‡ï¼Œå¯ä»¥ç›´æ¥æŠŠå®ƒå‘é€åˆ°åŠ¨å›¾åˆ¶ä½œå™¨å“¦ï¼æ— éœ€ä¸‹è½½å†ä¸Šä¼ ã€‚
                        </p>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šé¢„è§ˆç½‘æ ¼ -->
                <div class="lg:col-span-2">
                    <div
                        class="glass-panel rounded-3xl p-6 md:p-8 shadow-xl h-full min-h-[500px] flex flex-col relative">
                        <h2 class="font-cute text-xl font-bold mb-6 text-gray-700 flex items-center gap-2">
                            <i data-lucide="layout-grid" class="w-6 h-6 text-brand-purple"></i>
                            è¡¨æƒ…é¢„è§ˆå¢™
                        </h2>

                        <div x-show="cutter.slices.length === 0"
                            class="flex-1 flex flex-col items-center justify-center text-gray-300 border-4 border-dashed border-gray-100 rounded-2xl bg-white/50">
                            <i data-lucide="ghost" class="w-24 h-24 mb-4 opacity-20"></i>
                            <p class="font-bold text-lg">ç­‰å¾…æŠ•å–‚å›¾ç‰‡...</p>
                        </div>

                        <div x-show="cutter.slices.length > 0"
                            class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4 overflow-y-auto max-h-[600px] p-2 pr-4 custom-scrollbar">
                            <template x-for="(slice, index) in cutter.slices" :key="index">
                                <div
                                    class="group relative bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all hover:-translate-y-1 aspect-square flex items-center justify-center overflow-hidden bg-checkerboard">
                                    <img :src="slice" class="w-full h-full object-contain p-1">

                                    <!-- æ‚¬æµ®æ“ä½œ -->
                                    <div
                                        class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2 backdrop-blur-sm">
                                        <button @click="downloadSingleSlice(slice, index)"
                                            class="p-2 bg-white rounded-full text-brand-dark hover:text-brand-blue transition-colors transform hover:scale-110 shadow-lg"
                                            title="ä¸‹è½½æ­¤å›¾">
                                            <i data-lucide="download" class="w-4 h-4"></i>
                                        </button>
                                        <button @click="sendToAnimator(slice)"
                                            class="p-2 bg-white rounded-full text-brand-dark hover:text-brand-pink transition-colors transform hover:scale-110 shadow-lg"
                                            title="å»åˆ¶ä½œåŠ¨å›¾">
                                            <i data-lucide="film" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    <span
                                        class="absolute top-1 left-1 bg-black/50 text-white text-[10px] px-1.5 rounded-md font-mono"
                                        x-text="index + 1"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== æ¨¡å¼ 3: åŠ¨å›¾åˆ¶ä½œ (Animator) ==================== -->
        <div x-show="mode === 'animator'" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-x-4"
            x-transition:enter-end="opacity-100 transform translate-x-0" x-cloak>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                <!-- å·¦ä¾§ï¼šé…ç½® -->
                <div class="glass-panel rounded-3xl p-6 shadow-xl">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="font-cute text-xl font-bold text-gray-700">ç¬¬ä¸‰æ­¥ï¼šè®©å®ƒåŠ¨èµ·æ¥</h2>
                        <button @click="animator.imageSrc = null; animator.resultGif = null" x-show="animator.imageSrc"
                            class="text-xs text-red-400 hover:text-red-600 underline flex items-center gap-1">
                            <i data-lucide="trash-2" class="w-3 h-3"></i> æ¸…é™¤é‡ç½®
                        </button>
                    </div>

                    <!-- 1. é€‰æ‹©å›¾ç‰‡ -->
                    <div class="mb-6">
                        <label class="block w-full cursor-pointer group relative">
                            <div class="bg-white border-4 border-dashed border-brand-purple rounded-2xl h-48 flex flex-col items-center justify-center text-gray-400 transition-all overflow-hidden"
                                :class="{'border-solid border-brand-pink': animator.imageSrc}">

                                <template x-if="!animator.imageSrc">
                                    <div class="text-center group-hover:scale-105 transition-transform">
                                        <div
                                            class="w-12 h-12 bg-brand-purple/30 rounded-full flex items-center justify-center mx-auto mb-2 text-brand-dark">
                                            <i data-lucide="image-plus" class="w-6 h-6"></i>
                                        </div>
                                        <span class="font-bold text-sm text-gray-500">ä¸Šä¼ å•ä¸ªè¡¨æƒ…å›¾</span>
                                        <p class="text-xs text-gray-300 mt-1">(JPG / PNG / GIF)</p>
                                    </div>
                                </template>

                                <template x-if="animator.imageSrc">
                                    <div class="relative w-full h-full bg-checkerboard">
                                        <img :src="animator.imageSrc" class="w-full h-full object-contain p-4">
                                        <div
                                            class="absolute inset-0 flex items-center justify-center bg-black/0 hover:bg-black/10 transition-colors">
                                            <span
                                                class="opacity-0 hover:opacity-100 bg-black/60 text-white text-xs px-3 py-1 rounded-full">ç‚¹å‡»æ›´æ¢</span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            <input type="file" accept="image/*" class="hidden" @change="handleAnimatorUpload">
                        </label>
                    </div>

                    <!-- 2. å‚æ•°æ§åˆ¶ (æœ‰å›¾æ—¶æ˜¾ç¤º) -->
                    <div x-show="animator.imageSrc" x-transition class="space-y-6">

                        <!-- ç‰¹æ•ˆé€‰æ‹© -->
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase mb-2 block tracking-wider">é€‰æ‹©åŠ¨ä½œ
                                (Motion)</label>
                            <div class="grid grid-cols-3 gap-2">
                                <template x-for="ef in effects" :key="ef.id">
                                    <button @click="animator.effect = ef.id"
                                        :class="animator.effect === ef.id ? 'bg-brand-pink text-white ring-2 ring-brand-pink ring-offset-1 shadow-md' : 'bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-200'"
                                        class="py-3 px-1 rounded-xl text-xs font-bold transition-all text-center truncate active:scale-95"
                                        x-text="ef.name">
                                    </button>
                                </template>
                            </div>
                        </div>

                        <!-- å¼ºåº¦æ»‘å— -->
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100">
                            <div class="flex justify-between mb-3">
                                <label class="text-xs font-bold text-gray-500">åŠ¨ä½œå¹…åº¦</label>
                                <span
                                    class="text-xs font-mono bg-white px-2 py-0.5 rounded border border-gray-200 text-brand-pink"
                                    x-text="animator.intensity"></span>
                            </div>
                            <input type="range" min="1" max="10" x-model="animator.intensity"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-pink">

                            <div class="flex justify-between mb-3 mt-5">
                                <label class="text-xs font-bold text-gray-500">é€Ÿåº¦ (Speed)</label>
                                <span
                                    class="text-xs font-mono bg-white px-2 py-0.5 rounded border border-gray-200 text-brand-blue"
                                    x-text="animator.speed"></span>
                            </div>
                            <input type="range" min="0.5" max="3" step="0.1" x-model="animator.speed"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue">
                        </div>

                        <!-- ç”ŸæˆæŒ‰é’® -->
                        <button @click="generateGif" :disabled="animator.isGenerating"
                            class="btn-cute w-full py-4 rounded-2xl bg-gradient-to-r from-brand-pink to-brand-yellow text-brand-dark font-black text-lg shadow-xl shadow-orange-100 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-wait hover:scale-[1.02] active:scale-100 transform transition-all">
                            <i x-show="!animator.isGenerating" data-lucide="sparkles" class="w-5 h-5"></i>
                            <i x-show="animator.isGenerating" data-lucide="loader" class="w-5 h-5 animate-spin"></i>
                            <span x-text="animator.isGenerating ? 'é­”æ³•ç”Ÿæˆä¸­...' : 'ç”ŸæˆåŠ¨å›¾ GIF'"></span>
                        </button>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šé¢„è§ˆç»“æœ -->
                <div
                    class="glass-panel rounded-3xl p-8 shadow-xl flex flex-col items-center justify-center relative min-h-[400px] bg-white">

                    <div
                        class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMiIgY3k9IjIiIHI9IjEiIGZpbGw9IiM5QzlDOUMiLz48L3N2Zz4=')]">
                    </div>

                    <template x-if="!animator.resultGif && !animator.isGenerating">
                        <div class="text-center text-gray-300">
                            <div
                                class="w-32 h-32 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-slow border-4 border-dashed border-gray-100">
                                <i data-lucide="clapperboard" class="w-12 h-12"></i>
                            </div>
                            <p class="font-bold text-gray-400">åŠ¨å›¾é¢„è§ˆåŒº</p>
                        </div>
                    </template>

                    <template x-if="animator.isGenerating">
                        <div class="text-center z-10">
                            <div
                                class="w-16 h-16 border-4 border-brand-blue border-t-transparent rounded-full animate-spin mx-auto mb-4">
                            </div>
                            <p class="text-brand-blue font-bold animate-pulse">æ­£åœ¨é€å¸§æ¸²æŸ“...</p>
                            <p class="text-xs text-gray-400 mt-2">å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>
                        </div>
                    </template>

                    <template x-if="animator.resultGif">
                        <div class="text-center w-full animate-wiggle-enter z-10">
                            <div class="relative inline-block group">
                                <img :src="animator.resultGif"
                                    class="w-64 h-64 object-contain drop-shadow-2xl rounded-xl bg-white/50 backdrop-blur-sm border-4 border-white">
                                <div
                                    class="absolute -top-3 -right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform rotate-12 flex items-center gap-1 border-2 border-white">
                                    <i data-lucide="check" class="w-3 h-3"></i> DONE
                                </div>
                            </div>

                            <div class="mt-8 flex gap-4 justify-center">
                                <a :href="animator.resultGif" download="cute_emoji.gif"
                                    class="btn-cute py-3 px-8 bg-brand-dark text-white rounded-xl font-bold shadow-lg hover:bg-black flex items-center gap-2">
                                    <i data-lucide="download" class="w-5 h-5"></i> ä¸‹è½½ GIF
                                </a>
                                <button @click="animator.resultGif = null"
                                    class="py-3 px-4 bg-white border-2 border-gray-100 text-gray-500 rounded-xl font-bold hover:bg-gray-50 transition-colors">
                                    é‡åš
                                </button>
                            </div>
                        </div>
                    </template>
                </div>

            </div>
        </div>

    </main>

    <footer class="text-center mt-12 text-gray-400 text-xs font-sans">
        <p>Â© 2025 MeMaker Cute Workshop. All operations are local & secure.</p>
    </footer>

    <!-- é€»è¾‘è„šæœ¬ -->
    <script>
        function app() {
            return {
                mode: 'prompt', // prompt | cutter | animator
                promptType: 'grid', // grid | single

                toast: { show: false, message: '' },

                prompts: {
                    // é™æ€ç»„å›¾ (Grid)
                    grid: `Role: Professional Sticker Designer
Task: Create a set of LINE-style stickers for a Q-version male programmer character.
Style: Colorful hand-drawn, clean outlines, vibrant soft coloring, white background.
Layout: A single 4K (3840x2160) image with 24 distinct emojis arranged in a 4x6 grid.
Character: Blue messy hair, wearing a headset/tech accessory, half-body shot.
Expressions: 24 variations including happy, tired, typing furiously, eating, shocked, crying, "OK" hand sign, etc.
Text: Each sticker must have a handwritten Simplified Chinese caption (e.g., "æ”¶åˆ°", "BUG", "æ‘¸é±¼", "ä¸‹ç­", "æ•‘å‘½").
Constraints: No grid lines, pure white background, high resolution.`,

                    // åŠ¨å›¾ç´ æ (Single)
                    single: `Role: Character Designer
Task: Create a single high-quality asset for animation.
Subject: A cute Q-version male programmer character (blue hair, headset).
Pose: Front-facing, neutral or slightly happy expression, hands by side or simple gesture.
Style: LINE sticker aesthetic, flat color, clean thick outlines.
Background: Pure white (#FFFFFF), no shadows, no borders.
Constraint: The character must be fully contained within the frame, no cropping. High resolution (1024x1024).`
                },

                // åˆ‡å›¾æ•°æ®
                cutter: {
                    uploadedImage: null,
                    slices: [],
                    isProcessing: false,
                    cols: 4,
                    rows: 6
                },

                // åŠ¨å›¾æ•°æ®
                animator: {
                    imageSrc: null,
                    resultGif: null,
                    isGenerating: false,
                    effect: 'shake',
                    intensity: 5,
                    speed: 1,
                    workerBlobUrl: null
                },

                // ç‰¹æ•ˆåˆ—è¡¨
                effects: [
                    { id: 'shake', name: 'ç–¯ç‹‚æ‘‡å¤´' },
                    { id: 'spin', name: '360æ—‹è½¬' },
                    { id: 'wobble', name: 'æœå†»Qå¼¹' },
                    { id: 'pulse', name: 'æ€¥ä¿ƒå‘¼å¸' },
                    { id: 'zoom', name: 'é¬¼ç•œç¼©æ”¾' },
                    { id: 'vibrate', name: 'é«˜é¢‘éœ‡åŠ¨' }
                ],

                async initApp() {
                    try {
                        const resp = await fetch('https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js');
                        const txt = await resp.text();
                        const blob = new Blob([txt], { type: 'application/javascript' });
                        this.animator.workerBlobUrl = URL.createObjectURL(blob);
                    } catch (e) {
                        console.warn("Worker load failed", e);
                    }
                    this.$nextTick(() => lucide.createIcons());
                },

                showToast(msg) {
                    this.toast.message = msg;
                    this.toast.show = true;
                    setTimeout(() => { this.toast.show = false }, 2000);
                },

                copyText(text) {
                    // å…¼å®¹æ€§æ›´å¥½çš„å¤åˆ¶æ–¹æ¡ˆ
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();

                    try {
                        const successful = document.execCommand('copy');
                        if (successful) this.showToast("å¤åˆ¶æˆåŠŸï¼å¿«å»ç”Ÿæˆå§âœ¨");
                        else this.showToast("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶");
                    } catch (err) {
                        this.showToast("å¤åˆ¶å‡ºé”™");
                    }
                    document.body.removeChild(textArea);
                },

                // --- åˆ‡å›¾é€»è¾‘ ---
                handleCutterUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    this.cutter.isProcessing = true;
                    const reader = new FileReader();
                    reader.onload = (evt) => {
                        this.cutter.uploadedImage = evt.target.result;
                        setTimeout(() => this.processSlices(evt.target.result), 500);
                    };
                    reader.readAsDataURL(file);
                },

                processSlices(dataUrl) {
                    const img = new Image();
                    img.onload = () => {
                        const w = img.width / this.cutter.cols;
                        const h = img.height / this.cutter.rows;
                        const temp = [];
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = w;
                        canvas.height = h;

                        for (let r = 0; r < this.cutter.rows; r++) {
                            for (let c = 0; c < this.cutter.cols; c++) {
                                ctx.clearRect(0, 0, w, h);
                                ctx.drawImage(img, c * w, r * h, w, h, 0, 0, w, h);
                                temp.push(canvas.toDataURL('image/png'));
                            }
                        }
                        this.cutter.slices = temp;
                        this.cutter.isProcessing = false;
                        this.$nextTick(() => lucide.createIcons());
                    };
                    img.src = dataUrl;
                },

                downloadSingleSlice(dataUrl, index) {
                    const link = document.createElement('a');
                    link.href = dataUrl;
                    link.download = `emoji_${index + 1}.png`;
                    link.click();
                },

                async downloadAllSlices() {
                    const zip = new JSZip();
                    const folder = zip.folder("cute_emojis");

                    this.cutter.slices.forEach((data, i) => {
                        folder.file(`emoji_${i + 1}.png`, data.split(',')[1], { base64: true });
                    });

                    const content = await zip.generateAsync({ type: "blob" });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(content);
                    link.download = "emoji_pack.zip";
                    link.click();
                },

                // --- è”åŠ¨é€»è¾‘ ---
                sendToAnimator(imgSrc) {
                    this.animator.imageSrc = imgSrc;
                    this.animator.resultGif = null;
                    this.mode = 'animator';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    this.showToast("å·²å¯¼å…¥åˆ°åŠ¨å›¾å·¥åŠ ğŸ¬");
                },

                // --- åŠ¨å›¾é€»è¾‘ ---
                handleAnimatorUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (evt) => {
                        this.animator.imageSrc = evt.target.result;
                        this.animator.resultGif = null;
                    };
                    reader.readAsDataURL(file);
                },

                async generateGif() {
                    if (!this.animator.imageSrc || !this.animator.workerBlobUrl) return;

                    this.animator.isGenerating = true;
                    const size = 300;
                    const canvas = document.createElement('canvas');
                    canvas.width = size;
                    canvas.height = size;
                    const ctx = canvas.getContext('2d');

                    const gif = new GIF({
                        workers: 2,
                        quality: 10,
                        width: size,
                        height: size,
                        workerScript: this.animator.workerBlobUrl,
                        transparent: 0x00000000
                    });

                    const img = new Image();
                    img.src = this.animator.imageSrc;
                    await new Promise(r => img.onload = r);

                    const frames = 12;
                    const speed = this.animator.speed;
                    const intensity = this.animator.intensity;

                    for (let i = 0; i < frames; i++) {
                        ctx.clearRect(0, 0, size, size);
                        ctx.save();

                        const cx = size / 2;
                        const cy = size / 2;
                        ctx.translate(cx, cy);

                        const p = (i / frames) * Math.PI * 2 * speed;

                        if (this.animator.effect === 'shake') {
                            ctx.rotate(Math.sin(p) * 0.1 * (intensity / 3));
                        } else if (this.animator.effect === 'spin') {
                            ctx.rotate((i / frames) * Math.PI * 2);
                        } else if (this.animator.effect === 'wobble') {
                            const sx = 1 + Math.sin(p) * 0.1 * (intensity / 5);
                            const sy = 1 + Math.cos(p) * 0.1 * (intensity / 5);
                            ctx.scale(sx, sy);
                        } else if (this.animator.effect === 'pulse') {
                            const s = 1 + Math.sin(p) * 0.1 * (intensity / 5);
                            ctx.scale(s, s);
                        } else if (this.animator.effect === 'zoom') {
                            const s = 1 + (i % 2 === 0 ? 0 : 0.2 * (intensity / 5));
                            ctx.scale(s, s);
                        } else if (this.animator.effect === 'vibrate') {
                            const ox = (Math.random() - 0.5) * 10 * (intensity / 5);
                            const oy = (Math.random() - 0.5) * 10 * (intensity / 5);
                            ctx.translate(ox, oy);
                        }

                        const scale = Math.min(size / img.width, size / img.height) * 0.8;
                        ctx.drawImage(img, -img.width * scale / 2, -img.height * scale / 2, img.width * scale, img.height * scale);

                        ctx.restore();
                        gif.addFrame(ctx, { copy: true, delay: 100 });
                    }

                    gif.on('finished', (blob) => {
                        this.animator.resultGif = URL.createObjectURL(blob);
                        this.animator.isGenerating = false;
                        this.$nextTick(() => lucide.createIcons());
                    });

                    gif.render();
                }
            }
        }
    </script>
</body>

</html>